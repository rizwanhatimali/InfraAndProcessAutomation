parameters:
  - name: SonarQube
    type: object
  - name: AzureServiceConnection
    type: string
  - name: SonarqubeToken
    type: string
  - name: SonarqubeAdminUrl
    type: string
  - name: isPr
    type: boolean
steps:
  - ${{ if eq(parameters.SonarQube.Enabled, true) }}:
    - task: SonarSource.sonarqube.6D01813A-9589-4B15-8491-8164AEB38055.SonarQubeAnalyze@5
      displayName: 'Run Code Analysis'
    - task: SonarSource.sonarqube.291ed61f-1ee4-45d3-b1b0-bf822d9095ef.SonarQubePublish@5
      displayName: 'Publish Quality Gate Result'
  - ${{ if eq(parameters.SonarQube.QualityGateEnabled, true) }}:
    - template: "CheckSonarqubeQualityGate.yaml"
      parameters:
        azure:
          serviceConnection: ${{ parameters.AzureServiceConnection  }}
        sonar:
          token: ${{ parameters.SonarqubeToken }}
          url: ${{ parameters.SonarqubeAdminUrl }}
          projectKey: '${{ parameters.SonarQube.ProjectKey }}'
          isPr: ${{ parameters.isPr }}