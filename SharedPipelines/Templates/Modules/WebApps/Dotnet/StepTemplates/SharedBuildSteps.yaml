parameters:
  - name: SonarQube
    type: object
  - name: AzureServiceConnection
    type: string
  - name: SonarqubeToken
    type: string
  - name: isPr
    type: boolean
  - name: WorkingDirectory
    type: string
  - name: buildConfiguration
    type: string
    default: Release
  - name: SharedRepository
    type: string
    default: SharedPipelines
  - name: TestsEnabled
    type: boolean
  - name: JdkVersion
    type: string
    default: '17'
  - name: JdkArchitecture
    type: string
    default: 'x64'


steps:
  - checkout: self
  - checkout: ${{ parameters.SharedRepository }}
  - template: "SonarQubeTemplates/SonarQubePrepare.yaml"
    parameters:
      WorkingDirectory: ${{ parameters.WorkingDirectory }}
      SonarQube: ${{ parameters.SonarQube}}
  - template: "Build.yaml"
    parameters:
      WorkingDirectory: ${{ parameters.WorkingDirectory }}
      buildConfiguration: ${{ parameters.buildConfiguration }}
  - ${{ if eq(parameters.TestsEnabled, true) }}:
    - template: "UnitTest.yaml"
      parameters:
        WorkingDirectory: ${{ parameters.WorkingDirectory }}
        buildConfiguration: ${{ parameters.buildConfiguration }}
  - template: "SonarQubeTemplates/SonarQubeAnalysis.yaml"
    parameters:
      SonarQube : ${{ parameters.SonarQube }}
      AzureServiceConnection: ${{ parameters.AzureServiceConnection }}
      SonarqubeToken: ${{ parameters.SonarqubeToken }}
      isPr: ${{ parameters.isPr }}